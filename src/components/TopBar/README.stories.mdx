import dedent from 'ts-dedent';
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs';

import { ref } from 'vue';
import { Frame, TopBar, TopBarUserMenu, TopBarSearchField, TopBarMenu, Icon, VisuallyHidden, ActionList } from '@/polaris-vue';
import ArrowLeftMinor from '@icons/ArrowLeftMinor.svg';
import QuestionMarkMajor from '@icons/QuestionMarkMajor.svg';

<Meta
  title="Components / Navigation / Top Bar"
  component={ TopBar }
  argTypes={{
    default: {
      table: {
        disable: true,
      },
    },
    'navigation-toggle': {
      description: 'A callback function that handles hiding and showing mobile navigation',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    'search-result-dismiss': {
      description: 'A callback function that handles the dismissal of search results',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    contextControl: {
      description: 'Accepts a component that is used to help users switch between different contexts',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    searchField: {
      description: 'Accepts a search field component that is made available as a `TextField` static member of the top bar component',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    searchResults: {
      description: 'Accepts a search results component that is ideally composed of a card component containing a list of actionable search results',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    secondaryMenu: {
      description: 'Accepts a menu component that is made available as a static member of the top bar component',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
    userMenu: {
      description: 'Accepts a user component that is made available as a static member of the top bar component and renders as the primary menu',
      control: {
        disable: true,
      },
      table: {
        type: {
          summary: null,
        },
      },
    },
  }}
/>

export const Template = (args) => ({
  components: { Frame, TopBar, TopBarUserMenu, TopBarMenu, Icon, VisuallyHidden, TopBarSearchField, ActionList },
  setup() {
    const logo = {
      width: 30,
      topBarSource: 'https://github.com/qikify/polaris-vue/raw/dev/public/images/logo.png',
      contextualSaveBarSource: 'https://github.com/qikify/polaris-vue/raw/dev/public/images/logo.png',
    }
    const isUserMenuOpen = ref(false);
    const isSecondaryMenuOpen = ref(false);
    const isSearchActive = ref(false);
    const searchValue = ref('');
    const handleSearchChange = (value) => {
      isSearchActive.value = value.length > 0;
    }
    const handleSearchResultsDismiss = () => {
      searchValue.value = '';
      isSearchActive.value = false;
    }
    const toggleUserMenu = () => {
      isUserMenuOpen.value = !isUserMenuOpen.value;
    };
    const toggleIsSecondaryMenuOpen = () => {
      isSecondaryMenuOpen.value = !isSecondaryMenuOpen.value;
    };
    const userMenuAction = ref([
      { items: [{ content: 'Back to Shopify', icon: ArrowLeftMinor }] },
      { items: [{ content: 'Community forums' }] }]
    );
    const clickHandle = () => { alert('clicked'); };
    const userMenuMessage = ref({
      title: 'Another Message',
      description:'This is a description of message',
      action: { onClick: clickHandle, content: 'This is a action' },
      link: { to: 'https://google.com', content: 'Google Homepage' }
    });
    return { logo, isSearchActive, searchValue, handleSearchChange, toggleIsSecondaryMenuOpen, userMenuAction, userMenuMessage, toggleUserMenu, isUserMenuOpen, isSecondaryMenuOpen, handleSearchResultsDismiss, QuestionMarkMajor };
  },
  template: `
    <Frame :logo="logo">
      <template #topBar>
        <TopBar showNavigationToggle
          :searchResultsVisible="isSearchActive"
          @search-result-dismiss="handleSearchResultsDismiss"
        >
          <template #userMenu>
            <TopBarUserMenu
              :actions="userMenuAction"
              name="Polaris"
              detail="qikify"
              initials="P"
              :message="userMenuMessage"
              :open="isUserMenuOpen"
              @toggle="toggleUserMenu"
            />
          </template>
          <template #secondaryMenu>
            <TopBarMenu
              :open="isSecondaryMenuOpen"
              @open="toggleIsSecondaryMenuOpen"
              @close="toggleIsSecondaryMenuOpen"
              :actions="[{ items: [{content: 'Community forums'}] }, { items: [{content: 'Blog'}] }]"
            >
              <template #activatorContent>
                <span>
                  <Icon :source="QuestionMarkMajor" />
                  <VisuallyHidden>Secondary menu</VisuallyHidden>
                </span>
              </template>
            </TopBarMenu>
          </template>
          <template #searchField>
            <TopBarSearchField
              placeholder="Search"
              v-model="searchValue"
              :showFocusBorder="true"
              @change="handleSearchChange"
            />
          </template>
          <template #searchResults>
            <ActionList
              :items="[{content: 'Shopify help center', onAction: () => alert('ok')}, {content: 'Community forums'}]"
            />
          </template>
        </TopBar>
      </template>
    </Frame>
  `,
});

# Top Bar

The top bar is a header component that allows merchants to search, access menus, and navigate by clicking on the logo. It's always visible at the top of interfaces like Shopify or Shopify Plus. Third-party apps that use the top bar can customize the color to match their brand using the [app provider](?path=/docs/components-structure-appprovider--page) component and are required to use their own logo.

<Canvas>
  <Story
    name="Top Bar"
    inline={false}
    height="400px"
    width="400px"
    parameters={{
      docs: {
        source: {
          state: 'close',
          code: dedent`
            <Frame :logo="logo">
              <template #topBar>
                <TopBar showNavigationToggle
                  :searchResultsVisible="isSearchActive"
                  @search-result-dismiss="handleSearchResultsDismiss"
                >\n
                  <template #userMenu>
                    <TopBarUserMenu
                      :actions="userMenuAction"
                      name="Polaris"
                      detail="qikify"
                      initials="P"
                      :message="userMenuMessage"
                      :open="isUserMenuOpen"
                      @toggle="toggleUserMenu"
                    />
                  </template>\n
                  <template #secondaryMenu>
                    <TopBarMenu
                      :open="isSecondaryMenuOpen"
                      @open="toggleIsSecondaryMenuOpen"
                      @close="toggleIsSecondaryMenuOpen"
                      :actions="[{ items: [{content: 'Community forums'}] }, { items: [{content: 'Blog'}] }]"
                    >
                      <template #activatorContent>
                        <span>
                          <Icon :source="QuestionMarkMajor" />
                          <VisuallyHidden>Secondary menu</VisuallyHidden>
                        </span>
                      </template>
                    </TopBarMenu>
                  </template>\n
                  <template #searchField>
                    <TopBarSearchField
                      placeholder="Search"
                      v-model="searchValue"
                      :showFocusBorder="true"
                      @change="handleSearchChange"
                    />
                  </template>\n
                  <template #searchResults>
                    <ActionList
                      :items="[{content: 'Shopify help center', onAction: () => alert('ok')}, {content: 'Community forums'}]"
                    />
                  </template>\n
                </TopBar>
              </template>
            </Frame>\n\n
            setup() {
              const logo = {
                width: 30,
                topBarSource: 'https://github.com/qikify/polaris-vue/raw/dev/public/images/logo.png',
                contextualSaveBarSource: 'https://github.com/qikify/polaris-vue/raw/dev/public/images/logo.png',
              }
              const isUserMenuOpen = ref(false);
              const isSecondaryMenuOpen = ref(false);
              const isSearchActive = ref(false);
              const searchValue = ref('');\n
              const handleSearchChange = (value) => {
                isSearchActive.value = value.length > 0;
              }
              const handleSearchResultsDismiss = () => {
                searchValue.value = '';
                isSearchActive.value = false;
              }
              const toggleUserMenu = () => {
                isUserMenuOpen.value = !isUserMenuOpen.value;
              };
              const toggleIsSecondaryMenuOpen = () => {
                isSecondaryMenuOpen.value = !isSecondaryMenuOpen.value;
              };
              const userMenuAction = ref([
                { items: [{ content: 'Back to Shopify', icon: ArrowLeftMinor }] },
                { items: [{ content: 'Community forums' }] }]
              );
              const clickHandle = () => { alert('clicked'); };
              const userMenuMessage = ref({
                title: 'Another Message',
                description:'This is a description of message',
                action: { onClick: clickHandle, content: 'This is a action' },
                link: { to: 'https://google.com', content: 'Google Homepage' }
              });
              return { logo, isSearchActive, searchValue, handleSearchChange, toggleIsSecondaryMenuOpen, userMenuAction, userMenuMessage, toggleUserMenu, isUserMenuOpen, isSecondaryMenuOpen, handleSearchResultsDismiss, QuestionMarkMajor };
            },
          `,
        },
      },
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

<ArgsTable story="Top Bar" />
